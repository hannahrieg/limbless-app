{% from "components/spinner.jinja2" import spinner %}
{% from "components/metadata_group.jinja2" import metadata_group, metadata_group_link, metadata_group_email_link, metadata_quantity %}

{% extends "base.html" %}
{% set active_page = "seq_run-page" %}
{% block content %}
<div class="page-header-container">
    <div class="page-header">
        <div class="page-title">
            <h1>{{ seq_run.experiment_name }} <span class="desc">{{ seq_run.status.name }} {{ seq_run.status.icon }}</span></h1>
        </div>
        <div class="page-controls">
        </div>
    </div>
    <ul class="nav nav-tabs" id="auth-tab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="metadata-tab-btn" data-bs-toggle="tab" data-bs-target="#metadata-tab"
                type="button" role="tab" aria-controls="metadata-tab" aria-selected="true">
                Metadata
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stats-tab-btn" data-bs-toggle="tab" data-bs-target="#stats-tab"
                type="button" role="tab" aria-controls="stats-tab" aria-selected="true">
                Stats
            </button>
        </li>
    </ul>
</div>

<div class="page-content">
    <div class="tab-content pt-1">
        <div class="tab-pane fade show active" id="metadata-tab" role="tabpanel" tabindex="0">
            <div class="row">
                {% if experiment %}
                {{
                    metadata_group_link(
                        "Experiment", seq_run.experiment_name,
                        url_for("experiments_page.experiment", experiment_id=experiment.id, from="seq_run@" + seq_run.id | string),
                        class="col-3"
                    )
                }}
                {% else %}
                {{ metadata_group("Experiment", seq_run.experiment_name, class="col-3") }}
                {% endif %}
                {{ metadata_group("Run Folder", seq_run.run_folder, class="col-3") }}
                {{ metadata_group("Instrument", seq_run.instrument_name, class="col-3") }}
                {{ metadata_group("Flow Cell ID", seq_run.flowcell_id, class="col-3") }}
            </div>
            <div class="row">
                {{ metadata_group("Read Type", seq_run.read_type.name + " " + seq_run.read_type.icon, class="col-3") }}
                {{ metadata_group("RTA Version", seq_run.rta_version, class="col-3") }}
                {{ metadata_group("Recipe Version", seq_run.recipe_version, class="col-3") }}
                {{ metadata_group("Flow Cell Mode", seq_run.flowcell_mode, class="col-2") }}
                {{ metadata_group("Side", seq_run.side, class="col-1") }}
            </div>
            <div class="row">
                {{ metadata_group("R1 Cycles", seq_run.r1_cycles, class="col-3") }}
                {{ metadata_group("I1 Cycles", seq_run.i1_cycles, class="col-3") }}
                {{ metadata_group("I2 Cycles", seq_run.i2_cycles, class="col-3") }}
                {{ metadata_group("R2 Cycles", seq_run.r2_cycles, class="col-3") }}
            </div>
        </div>
        <div class="tab-pane fade" id="stats-tab" role="tabpanel" tabindex="1">
            {% for key, quantity in seq_run.quantities.items() %}
            {% if loop.index0 % 4 == 0 %}
            <div class="row">
                {% endif %}
                {{ metadata_quantity(key.replace("_", " ").title(), quantity, class="col-3") }}
                {% if loop.index0 % 4 == 3 or loop.last %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock content %}