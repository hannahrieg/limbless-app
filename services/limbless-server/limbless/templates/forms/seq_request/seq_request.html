{% from 'components/form_group.jinja2' import form_group, select_input %}
<form id="seq_request-form">
    {{ seq_request_form.csrf_token() }}
    
    <h4>Request Info</h4>
    {{ form_group(seq_request_form.name) }}
    {{ form_group(seq_request_form.description) }}

    <hr>
    <h4>Technical Requirements</h4>
    <div class="row">
        {{ form_group(seq_request_form.technology, class="col-5") }}
        {{ select_input(seq_request_form.sequencing_type, class="col-5") }}
        {{ form_group(seq_request_form.read_length, class="col-2") }}
    </div>

    <div class="row">
        {{ form_group(seq_request_form.sequencer, class="col-5") }}
        {{ select_input(seq_request_form.flowcell_type, class="col-5") }}
        {{ form_group(seq_request_form.num_lanes, class="col-2") }}
    </div>

    <div class="row">
        {{ form_group(seq_request_form.num_cycles_read_1, class="col") }}
        {{ form_group(seq_request_form.num_cycles_index_1, class="col") }}
        {{ form_group(seq_request_form.num_cycles_index_2, class="col") }}
        {{ form_group(seq_request_form.num_cycles_read_2, class="col") }}
    </div>
    {{ form_group(seq_request_form.special_requirements, class="col") }}

    <hr>
    <h4>Contact Person</h4>
    <div class="form-check form-switch">
        {{ seq_request_form.current_user_is_contact(class="form-check-input") }}
        <label class="form-check-label">I am contact person.</label>
    </div>
    <div class="row">
        {{ 
            form_group(
                seq_request_form.contact_person_name,
                disabled=seq_request_form.current_user_is_contact.data,
                class="col-6 col-xl-3",
            ) 
        }}
        {{ 
            form_group(
                seq_request_form.contact_person_email,
                disabled=seq_request_form.current_user_is_contact.data,
                class="col-6 col-xl-5"
            )
        }}
        {{ 
            form_group(
                seq_request_form.contact_person_phone,
                class="col-6 col-xl-4"
            ) 
        }}
    </div>

    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#bioinformatician-collapse-section" aria-expanded="false" aria-controls="bioinformatician-collapse-section">
        Add Bioinformatician Contact
    </button>

    <div class="collapse {{ 'show' if seq_request_form.bioinformatician_name.data else ''}}" id="bioinformatician-collapse-section">
        <div class="card-body pt-3">
          <h4>Bioinformatician Contact</h4>
            <div class="row">
                {{ form_group(seq_request_form.bioinformatician_name, class="col-6 col-xl-3") }}
                {{ form_group(seq_request_form.bioinformatician_email, class="col-6 col-xl-5") }}
                {{ form_group(seq_request_form.bioinformatician_phone, class="col-6 col-xl-4") }}
            </div>
        </div>
    </div>

    <hr>
    <h4>Organization</h4>
    <div class="row">
        {{ form_group(seq_request_form.organization_name, class="col-6 col-xl-3") }}
        {{ form_group(seq_request_form.organization_address, class="col-6 col-xl-5") }}
        {{ form_group(seq_request_form.organization_department, class="col-6 col-xl-4") }}
    </div>

    <hr>
    <h4>Billing Info</h4>
    <div class="form-check form-switch">
        {{ seq_request_form.billing_is_organization(class="form-check-input") }}
        <label class="form-check-label">Use organization as billing address.</label>
    </div>
    <div class="row">
        {{ form_group(seq_request_form.billing_contact, class="col-6 col-xl-3", disabled=seq_request_form.billing_is_organization.data) }}
        {{ form_group(seq_request_form.billing_address, class="col-6 col-xl-5", disabled=seq_request_form.billing_is_organization.data) }}
        {{ form_group(seq_request_form.billing_code, class="col-6 col-xl-4") }}
    </div>
    <div class="row">
        {{ form_group(seq_request_form.billing_email, class="col") }}
        {{ form_group(seq_request_form.billing_phone, class="col") }}
    </div>
</form>

<script>
    init_tooltips();

    $("#billing_is_organization").on("click", function(){
        const checked = $(this).is(":checked");
        if (checked){
            $("#billing_contact").addClass("disabled");
            $("#billing_contact").prop("readonly", true);
            $("#billing_contact").val($("#organization_name").val());

            $("#billing_address").addClass("disabled");
            $("#billing_address").prop("readonly", true);
            $("#billing_address").val($("#organization_address").val());

        } else {
            $("#billing_contact").removeClass("disabled");
            $("#billing_contact").prop("readonly", false);
            $("#billing_contact").val("");

            $("#billing_address").removeClass("disabled");
            $("#billing_address").prop("readonly", false);
            $("#billing_address").val("");
        }
    });
    $("#organization_name").on("keyup", function(){
        if ($("#billing_is_organization").is(":checked")){
            $("#billing_contact").val($(this).val());
        }
    });
    $("#organization_address").on("keyup", function(){
        if ($("#billing_is_organization").is(":checked")){
            $("#billing_address").val($(this).val());
        }
    });

    $("#current_user_is_contact").on("click", function(){
        const checked = $(this).is(":checked");
        if (checked){
            $("#contact_person_name").addClass("disabled");
            $("#contact_person_name").prop("readonly", true);
            $("#contact_person_name").val("{{ current_user.first_name }} {{ current_user.last_name }}");

            $("#contact_person_email").addClass("disabled");
            $("#contact_person_email").prop("readonly", true);
            $("#contact_person_email").val("{{ current_user.email }}");

        } else {
            $("#contact_person_name").removeClass("disabled");
            $("#contact_person_name").prop("readonly", false);
            $("#contact_person_name").val("");

            $("#contact_person_email").removeClass("disabled");
            $("#contact_person_email").prop("readonly", false);
            $("#contact_person_email").val("");
        }
    });
</script>