{% macro search_select_field(field, url, results, selected, include_data_element=True, disabled=false) -%}
{% set field_name = field.name %}
{% set class_str = "form-control search-component search-select-input" + (" disabled" if disabled else "") + (" is-invalid" if (field.errors and not disabled) else "") %}
<div id="{{field_name}}-select" class="search-select form-group">
    <label for="{{field_name}}">{{ field.label }}</label>
    <div class="input-group">
        <input type="search"
        onclick="this.select();"
        class="{{ class_str }}"
        autocomplete="off"
        name="{{field_name}}-search"
        id="{{field_name}}-search"
        aria-controls="#{{field_name}}-results"
        value="{{ selected }}"
        hx-get="{{ url }}"
        hx-target="#{{field_name}}-results"
        hx-trigger="keyup changed delay:500ms, {{field_name}}"
        hx-swap="innerHTML"
        placeholder="Search"
        readonly=disabled>
    </div>
    <div class="input-group">
        <div id="{{field_name}}-results" class="search-select-results">
            {% include "components/search_select_results.html" %}
        </div>
    </div>
    <div class="invalid-feedback-container" id="{{field_name}}-invalid-container">
    {% if field.errors %}
            {% for error in field.errors %}
            <p>{{ error }}</p>
            {% endfor %}
    {% endif %}
    </div>
</div>
{% if include_data_element %}
    {{ field(hidden=False, readonly=True) }}
{% endif %}
<script>
    // Shows search results when user focuses on search component
    $("#{{field_name}}-search").on("focus", function() {
        if ($(this).hasClass("disabled")) {
            return;
        }
        $("#{{field_name}}-results").css("display", "block");
    });

    $("#{{field_name}}-search").on("change", function() {
        if ($(this).val() === "") {
            $("#{{field_name}}").val("");
        }
    });
</script>
{%- endmacro %}
