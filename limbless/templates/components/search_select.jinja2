{% macro search_select_field(field, url, results, selected) -%}
<div id="{{field.name}}-select" class="search-select form-group">
    <label for="{{field.name}}_search">{{ field.label }}</label>
    <div class="input-group">
        <span class="input-group-text selected-label"id="{{field.name}}-selected-label">{{ selected }}</span>
        <input type="search"
        class="{{'form-control is-invalid' if field.errors else 'form-control'}}"
        autocomplete="off"
        name="{{field.name}}_search"
        id="{{field.name}}_search"
        hx-post="{{ url }}"
        hx-target="#{{field.name}}-results"
        hx-trigger="keyup changed delay:500ms, {{field.name}}"
        data-bs-toggle="dropdown"
        hx-swap="innerHTML"
        placeholder="Search">
    </div>
    <div class="invalid-feedback-container" id="{{field.name}}-invalid-container">
        {% for error in field.errors %}
        <p class="">{{ error }}</p>
        {% endfor %}
    </div>
    <ul id="{{field.name}}-results" class="dropdown-menu">
        {% include "components/search_select_results.html" %}
    </ul>
</div>
<script>
    function select_option(name, id) {
        $('#{{field.name}}-results').css('display', 'none');
        $('#{{field.name}}').val(id);
        $('#{{field.name}}-selected-label').text(name);
        $('#{{field.name}}_search').removeClass('is-invalid');
        $('#{{field.name}}-invalid-container').empty();
    }

    $("#{{field.name}}_search").on("focus", function() {
        $('#{{field.name}}-results').css('display', 'block');
        $('#{{field.name}}-invalid-container').hide();
    });

</script>
{%- endmacro %}
