{% macro search_select_field(field, url, results, selected, id) -%}
{% if id is defined %}
{% else %}
    {% set id = field.name %}
{% endif %}
<div id="{{id}}-select" class="search-select form-group">
    <label for="{{id}}_search">{{ field.label }}</label>
    <div class="input-group">
        <span class="input-group-text selected-label"
        id="{{id}}-selected-label">{{ selected }}</span>
        <input type="search"
        class="{{'form-control is-invalid search-component' if field.errors else 'form-control search-component'}}"
        autocomplete="off"
        name="{{id}}_search"
        id="{{id}}_search"
        hx-post="{{ url }}"
        hx-target="#{{id}}-results"
        hx-trigger="keyup changed delay:500ms, {{id}}"
        data-bs-toggle="dropdown"
        hx-swap="innerHTML"
        placeholder="Search">
        <div id="{{id}}-results" class="search-results-container">
            {% set field_name = id %}
            {% include "components/search_select_results.html" %}
        </div>
    </div>
    <div class="invalid-feedback-container" id="{{id}}-invalid-container">
        {% for error in field.errors %}
        <p>{{ error }}</p>
        {% endfor %}
    </div>
</div>
<script>
    function select_option(name, id, field_name) {
        $(`#${field_name}-results`).css("display", "none");
        $(`#${field_name}`).val(id);

        $(`#${field_name}-selected-label`).text(name);

        if ($(`#${field_name}_search`).hasClass("is-invalid")){
            $(`#${field_name}_search`).removeClass("is-invalid");
        }
        $(`#${field_name}-invalid-container`).empty();
    }

    $("#{{field_name}}_search").on("focus", function(event) {
        event.preventDefault();
        $("#{{field_name}}-results").css("display", "block");
        $("#{{field_name}}-results").children().css("display", "block");
        $("#{{field_name}}-invalid-container").empty();
    });

    $(document).on("mousedown", function(event) {
        if (!event.target.classList.contains("search-component")) {
            $("#{{field_name}}-results").css("display", "none");
        }
    });

</script>
{%- endmacro %}
