{% from 'components/form_group.jinja2' import form_group, switch_input %}
{% from 'components/search_select.jinja2' import search_select_field %}
<form id="library-form">
    {{ library_form.csrf_token }}
    {{ form_group(library_form.name) }}
    {{ form_group(library_form.library_type, trigger_dest_id="index_kit-search") }}

    {{ switch_input(library_form.is_premade_library) }}


    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#librarycontact-collapse-section" aria-expanded="false" aria-controls="librarycontact-collapse-section">
        Add Library Contact Person
    </button>
    <br>

    <div class="collapse {{ 'show' if seq_request_form.library_contact_name.data else ''}}" id="librarycontact-collapse-section">
        <div class="card-body pt-3">
            {{ switch_input(library_form.current_user_is_library_contact) }}
            <h4>Library Contact Person</h4>
            <div class="row">
                {{ form_group(library_form.library_contact_name, class="col-6 col-xl-3") }}
                {{ form_group(library_form.library_contact_email, class="col-6 col-xl-5") }}
                {{ form_group(library_form.library_contact_phone, class="col-6 col-xl-4") }}
            </div>
        </div>
    </div>
    <br>

    {{ 
        search_select_field(
            library_form.index_kit,
            url=url_for('indices_htmx.query_index_kits'),
            selected=selected_kit,
            disabled=not library_form.is_premade_library.data,
            include_field="library_type"
        )
    }}
</form>
<script>
    $("#is_premade_library").on("change", function() {
        if (!$(this).is(":checked")) {
            $("#index_kit-search").addClass("disabled");
            $("#index_kit-search").prop("readonly", true);
            $("#index_kit-search").val("");
            $("#index_kit").val("");

        } else {
            $("#index_kit-search").removeClass("disabled");
            $("#index_kit-search").prop("readonly", false);
        }
    });
</script>